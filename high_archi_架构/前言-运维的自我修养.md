# 前言-运维的自我修养



# 运维线路



1. 运维学习的和发展的一个线路：

> 1. 搭建服务（部署并运行起来）
> 1. 用好服务（监控、管理、优化）
> 1. 自动化（服务直接的关联和协同工作）
> 1. 产品设计（如何设计一个监控系统）
>
> 云计算的核心竞争力是运维！
> 系统架构师（偏管理）：网络、系统、数据库、开发、云计算、自动化、运维管理、服务管理、项目管理、测试、业务
> 专注于某一领域

2. 运维工作内容分类：

- 监控运维（7*24运维值班，故障处理）
- 应用运维（业务熟悉、服务部署、业务部署、版本管理、灰度发布、应用监控）
- 安全运维（整体的安全方案、规范、漏洞检测、安全防护等）
- 系统运维（架构层面的分布式缓存、分布式文件系统、日志收集、环境规划（测试、开发、生产）、架构设计、性能优化）
- 基础服务运维（包含运维开发）（内部DNS、负载均衡、系统监控、资产管理、运维平台）
- 基础设施运维（系统初始化、网络维护）



---

# 运维工作及分类



1. 运维工作流程：
  - 准备/检查好环境，centos6？centos7？
  - 进行操作前的备份、注释，例如网络配置文件
  - 进行配置之后注意保存
  - 配置完成需要检查成果，是否生效
  - 编写项目（技术）文档

---



## 运维标准化



- 物理设备层面
  - 服务器标签化、设备负责人、设备采购详情、设备摆放标准
  - 网络划分、远程控制卡、网卡端口
  - 服务器机型、硬盘、内存统一。根据业务分类
  - 资产命名规范、编号规范、类型规范
  - 监控标准
- 操作系统层面
  - 操作系统版本
  - 系统初始化（DNS、NTP、内核参数调优、rsyslog、主机名规范）
  - 基础agent配备（zabbix agent、logstash agent、saltstack minion）
  - 系统监控标准（CPU、内存、硬盘、网络、进程）
- 应用服务层面
  - web服务器选型（apache、nginx）
  - 进程启动用户、端口监听规范、日志收集规范（访问日志、错误日志、运行日志）
  - 配置管理（配置文件规范、脚本规范）
  - 架构规范（nginx+keepalived、lvs+keepalived等）
  - 部署规范（位置、包命名等）
- 运维操作层面
  - 机房巡检流程（周期、内容、报修流程）
  - 业务部署流程（先测试、后生产。回滚）
  - 故障处理流程（紧急处理、故障升级、重大故障管理）
  - 工作日志标准（如何编写工作日志）
  - 业务上线流程（1.项目发起 2.系统安装 3.部署nginx 4.解析域名 5.测试 6.加监控 7.备份）
  - 业务下线流程（谁发起，数据如何处理。）
  - 运维安全规范（密码复杂度、更改周期、）
  - 这些都可以按照实际增减的
1. **目标：规范化、流程化、文档化，为了实现文档化**

---



## 工具化



1. shell脚本（功能性（流程）脚本、检查下、报表性）
1. 开源工具：zabbix、ELKStack、SaltStack、Cobbler
1. 目标：
  - 为了促进标准化的实施
  - 将重复的操作，简单化
  - 将多次操作，流程化
  - 减少人为操作的低效、降低故障率
4. **痛点：**
  - 至少要ssh到服务器，再执行
  - 多个脚本有执行顺序的时候，可能犯错
  - 权限不好管理，日志没法统计
  - ...
## web化



1. 运维平台，例如job管理平台
- 做成web界面
- 权限控制
- 日志记录
- 弱化流程
- 不需ssh到服务器
2. 例如，负载均衡web管理、job管理平台、监控平台zabbix、操作系统安装平台
## 服务化（API化）



1. 调用cobbler-api安装操作系统
1. saltstack-api进行系统初始化
1. dns-api，解析主机名
1. zabbix-api将新上线机器加上监控
1. saltstack-api部署软件（安装nginx+php）
1. deploy-api，将当前版本的代码部署到服务器上
1. test-api，测试当前服务运行是否正常
1. slb-api，将该节点加入集群
## 智能化



1. 自动化扩容、缩容、服务降级、故障自愈
- 触发机制->决策系统（决策树）->->->（以扩容为例）
  - zabbix触发action
    - 先判断buffer是否有最近x小时，已经移除的虚拟机，并查询软件版本是否和当前一致
    - 如果一致，跳过2/3/4步骤；否则跳过2/3步骤
  - openstack创建虚拟机
  - saltstack配置环境    ----监控（所以实际使用中，需要考虑多方面）
  - 部署系统部署当前代码
  - 测试服务是否可用（注意间隔和次数）
  - 加入集群
  - 通知（短信、邮件）
- 自动化缩容：
  - 触发条件和决策
  - 从集群中移除节点    --关闭监控-移除
  - 通知
  - 移除的节点存放于buffer里面
  - buffer里超过1天的虚拟机，自动关闭，存放于xx区
  - xx区的虚拟机，每7天清理删除

---

# 基于ITIL的IT运维管理体系



1. 先有ITSM（IT服务管理），后有ITIL（IT基础架构库）
- 有5本书（最佳实践），看
- ITIL是ITSM的最佳实践。ITIL，即IT基础结构库
- ITIL只是告诉我们，什么该做，但没有说具体怎么做。而对ITSM而言，这些都是ITSM的范围
- PDCA，戴明环
2. SLA（Service Level Agreement） 服务级别协议
- OLA（Operation Level Agreement）运营水平协议
- CSF（Critical Success Factor）关键成功因素
- KPI（Key Performance Indicator）关键绩效指标
3. 服务台：call center，呼叫中心。
   3. 作为IT服务支持团队的一线支持，其首要目标是为用户和IT组织之间建立沟通的纽带，确保用户的故障请求和服务请求能够以最快的速度得到满足，并确保用户满意
   3. 功能：路由器；监视器；单一联系点；客服窗口；广播台；过滤器
3. 故障管理的目标：尽可能恢复到正常的服务运行，将故障对业务运营的负面影响减小到最低，并确保达到最好的服务质量和可用性水平
  - 综合考虑两个方面：紧急度（urgency）、影响度（impact）
5. 故障管理与问题管理对比

- 故障管理流程输入：
  - 故障请求提交；故障单记录模板；故障单填写模板；故障分类规则；故障优先级确定规则；故障升级规则；故障处理时间规则；故障关闭规则
- 故障管理流程输出：
  - 故障历史记录；故障分类汇总统计表；故障处理用户满意度

| 比较难度     | 故障管理                           | 问题管理                             |
| ------------ | ---------------------------------- | ------------------------------------ |
| 根本目标     | 尽快恢复服务，降低对业务的影响     | 查明根源，彻底解决                   |
| 手段         | 应急措施或者替代方案               | 永久性解决方案                       |
| 关注的焦点   | 速度                               | 质量（彻底性）                       |
| 花费时间     | 短                                 | 长                                   |
| 优先级划分   | 根据影响度和紧急度确定，侧重紧急度 | 根据影响度和紧急度确定，侧重于影响度 |
| 是否面向用户 | 面向用户                           | 不面向用户                           |
| 分类代码     | 二者可共享相同的分类代码           | 同左                                 |

6. 问题管理的输入和输出
7. 问题管理的关键绩效指标

<img src="https://cdn.jsdelivr.net/gh/liuzel01/MyPicBed@master/data/20200506151148.png" alt="ITIL1" style="zoom: 80%;" />

8. ITSM工具架构

<img src="https://cdn.jsdelivr.net/gh/liuzel01/MyPicBed@master/data/20200506151311.png" alt="ITIL2" style="zoom: 80%;" />



##  SVS核心组件



1. ITIL指导原则(ITIL guiding priciples)，与敏捷的配合

- 关注价值
- 从你所在的地方开始
- 有反馈的迭代式进展
- 协作并促进可见性
- 整体地思考和工作
- 保持简单和实用
- 优化和自动化 



2. 治理(governance)

3. ITIL服务价值链(the ITIL service value chain)

- 六个价值链活动：计划(Plan)、改进(Improve)、参与(Engage、Stakeholder)、设计和转换(Design and transition)、
- 获得/构建（硬件/软件）/组件  (Obtain/build)
- 交付和支持(Deliver & support)（产品服务）



4. ITIL实践

- 一般管理实践（General management practices）
- 服务管理实践（Service management practices）
- 技术管理实践



5. 持续改进



---



# 推荐阅读

1. <u>DevOps实践指南，DevOps时代</u>
2. 精益相关的：<u>改变世界的机器，精益开发看板方法</u>
3. <u>IT服务管理</u>
4. 思维方式的迭代：<u>冰山在融化，金字塔原理</u>
5. <u>遥远的救世主，天幕红尘，做单</u>  